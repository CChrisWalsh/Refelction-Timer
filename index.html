<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Reflection Timer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Basic styling -->
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: #f9fafb;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at top left, #3b82f6, #0f172a);
        overflow: hidden;
      }

      /* Gentle animated background */
      .background-orbits {
        position: fixed;
        inset: 0;
        pointer-events: none;
        overflow: hidden;
        z-index: 0;
      }

      .orbit {
        position: absolute;
        border-radius: 9999px;
        border: 1px solid rgba(148, 163, 184, 0.15);
        animation: orbit 18s linear infinite;
      }

      .orbit.orbit-1 {
        width: 420px;
        height: 420px;
        top: -120px;
        left: -80px;
      }

      .orbit.orbit-2 {
        width: 520px;
        height: 520px;
        bottom: -180px;
        right: -120px;
        animation-duration: 26s;
      }

      .orbit.orbit-3 {
        width: 680px;
        height: 680px;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation-duration: 34s;
      }

      .orbit-glow {
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: radial-gradient(
          circle,
          rgba(96, 165, 250, 0.18),
          transparent 70%
        );
        filter: blur(10px);
      }

      @keyframes orbit {
        from {
          transform: rotate(0deg) translateZ(0);
        }
        to {
          transform: rotate(360deg) translateZ(0);
        }
      }

      .app-shell {
        position: relative;
        z-index: 1;
        max-width: 720px;
        width: 100%;
        padding: 24px;
      }

      .card {
        background: rgba(15, 23, 42, 0.88);
        border-radius: 24px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        box-shadow: 0 22px 60px rgba(15, 23, 42, 0.7);
        padding: 24px 24px 28px;
        backdrop-filter: blur(22px);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 16px;
        margin-bottom: 20px;
      }

      .title-block h1 {
        font-size: 1.4rem;
        font-weight: 600;
        letter-spacing: 0.03em;
      }

      .title-block p {
        font-size: 0.88rem;
        color: #e5e7eb;
        opacity: 0.9;
        margin-top: 4px;
      }

      .chip {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        color: #dbeafe;
        background: linear-gradient(
          135deg,
          rgba(37, 99, 235, 0.2),
          rgba(8, 47, 73, 0.4)
        );
      }

      .main-layout {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
        gap: 20px;
        align-items: center;
      }

      @media (max-width: 768px) {
        .main-layout {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .timer-visual {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 6px;
      }

      .timer-circle {
        position: relative;
        width: 260px;
        height: 260px;
      }

      .timer-circle svg {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
      }

      .timer-inner {
        position: absolute;
        inset: 20px;
        border-radius: 999px;
        background: radial-gradient(circle at top, #1d4ed8, #020617);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .time-display {
        font-variant-numeric: tabular-nums;
        font-size: 2.4rem;
        font-weight: 600;
        letter-spacing: 0.12em;
      }

      .status-label {
        margin-top: 4px;
        font-size: 0.8rem;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        color: #bfdbfe;
        opacity: 0.9;
      }

      .prompt-panel {
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      .prompt-heading {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        color: #93c5fd;
      }

      .prompt-text {
        background: rgba(15, 23, 42, 0.9);
        border-radius: 16px;
        padding: 12px 14px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        font-size: 0.98rem;
        line-height: 1.45;
        color: #e5e7eb;
      }

      .prompt-step {
        font-size: 0.78rem;
        color: #9ca3af;
        margin-top: 3px;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }

      button {
        border-radius: 999px;
        border: none;
        padding: 8px 16px;
        font-size: 0.85rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
      }

      .btn-primary {
        background: linear-gradient(135deg, #2563eb, #4f46e5);
        color: white;
      }

      .btn-secondary {
        background: rgba(15, 23, 42, 0.95);
        color: #e5e7eb;
        border: 1px solid rgba(148, 163, 184, 0.6);
      }

      .btn-ghost {
        background: transparent;
        color: #bfdbfe;
        border: 1px solid rgba(148, 163, 184, 0.4);
      }

      .sound-indicator {
        margin-left: auto;
        font-size: 0.78rem;
        color: #9ca3af;
      }

      .footer-note {
        margin-top: 16px;
        font-size: 0.78rem;
        color: #9ca3af;
        display: flex;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }
    </style>

    <!-- React + ReactDOM + Babel from CDNs -->
    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>

  <body>
    <!-- Soothing animated background -->
    <div class="background-orbits">
      <div class="orbit orbit-1">
        <div class="orbit-glow"></div>
      </div>
      <div class="orbit orbit-2">
        <div class="orbit-glow"></div>
      </div>
      <div class="orbit orbit-3">
        <div class="orbit-glow"></div>
      </div>
    </div>

    <!-- React mount point -->
    <div id="root" class="app-shell"></div>

    <!-- Your timer app -->
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      const TOTAL_SECONDS = 5 * 60; // 5 minutes

      const reflectionPrompts = [
        "Settle in. Take a deep breath and arrive in this moment.",
        "What is one idea from class content that feels most important?",
        "How does the content connect to your real work or life?",
        "What is one question you still have?",
        "What is one small action you will take after this class?",
        "Capture your final thought in a single sentence."
      ];

      // NOTE: direct URL to your hosted song
      const SONG_URL =
        "https://raw.githubusercontent.com/CChrisWalsh/calmingmusic/main/reflective-silent-horizons-332367.mp3";

      function formatTime(secs) {
        const m = String(Math.floor(secs / 60)).padStart(2, "0");
        const s = String(secs % 60).padStart(2, "0");
        return `${m}:${s}`;
      }

      function ReflectionTimer() {
        const [secondsLeft, setSecondsLeft] = useState(TOTAL_SECONDS);
        const [isRunning, setIsRunning] = useState(false);
        const [promptIndex, setPromptIndex] = useState(0);
        const [isMusicOn, setIsMusicOn] = useState(true);

        const intervalRef = useRef(null);
        const audioRef = useRef(null);

        // Load audio
        useEffect(() => {
          const audio = new Audio(SONG_URL);
          audio.loop = true;
          audio.volume = 0.45;
          audioRef.current = audio;

          return () => {
            if (audioRef.current) {
              audioRef.current.pause();
              audioRef.current = null;
            }
          };
        }, []);

        // Timer + prompt progression
        useEffect(() => {
          if (!isRunning) {
            if (intervalRef.current !== null) {
              clearInterval(intervalRef.current);
              intervalRef.current = null;
            }
            return;
          }

          intervalRef.current = setInterval(() => {
            setSecondsLeft((prev) => {
              if (prev <= 1) {
                clearInterval(intervalRef.current);
                intervalRef.current = null;
                setIsRunning(false);
                return 0;
              }

              const next = prev - 1;
              const elapsed = TOTAL_SECONDS - next;
              const newIndex = Math.min(
                reflectionPrompts.length - 1,
                Math.floor(elapsed / 60)
              );
              setPromptIndex(newIndex);
              return next;
            });
          }, 1000);

          return () => {
            if (intervalRef.current !== null) {
              clearInterval(intervalRef.current);
              intervalRef.current = null;
            }
          };
        }, [isRunning]);

        // Handle music start / stop
        useEffect(() => {
          const audio = audioRef.current;
          if (!audio) return;

          if (isRunning && isMusicOn) {
            audio
              .play()
              .catch((e) =>
                console.warn(
                  "Browser blocked autoplay; sound will start after first click.",
                  e
                )
              );
          } else {
            audio.pause();
          }
        }, [isRunning, isMusicOn]);

        const handleStartPause = () => {
          setIsRunning((prev) => !prev);
        };

        const handleReset = () => {
          setIsRunning(false);
          setSecondsLeft(TOTAL_SECONDS);
          setPromptIndex(0);
        };

        const toggleMusic = () => {
          setIsMusicOn((prev) => !prev);
        };

        const progress = 1 - secondsLeft / TOTAL_SECONDS;
        const radius = 110;
        const circumference = 2 * Math.PI * radius;
        const dashOffset = circumference * (1 - progress);

        const statusLabel = isRunning
          ? "In session"
          : secondsLeft === TOTAL_SECONDS
          ? "Ready to begin"
          : "Paused";

        return (
          <div className="card">
            <div className="card-header">
              <div className="title-block">
                <h1>Reflection Timer</h1>
                <p>
                  Guided prompts, focused sound, and a calm visual to support
                  quiet thinking time.
                </p>
              </div>
              <div className="chip">Class Reflection</div>
            </div>

            <div className="main-layout">
              {/* Timer Visual */}
              <div className="timer-visual">
                <div className="timer-circle">
                  <svg>
                    <circle
                      cx="50%"
                      cy="50%"
                      r={radius}
                      stroke="rgba(30,64,175,0.45)"
                      strokeWidth="10"
                      fill="none"
                    />
                    <circle
                      cx="50%"
                      cy="50%"
                      r={radius}
                      stroke="url(#timerGradient)"
                      strokeWidth="10"
                      fill="none"
                      strokeDasharray={circumference}
                      strokeDashoffset={dashOffset}
                      strokeLinecap="round"
                    />
                    <defs>
                      <linearGradient
                        id="timerGradient"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="100%"
                      >
                        <stop offset="0%" stopColor="#93c5fd" />
                        <stop offset="50%" stopColor="#a855f7" />
                        <stop offset="100%" stopColor="#22c55e" />
                      </linearGradient>
                    </defs>
                  </svg>

                  <div className="timer-inner">
                    <div className="time-display">
                      {formatTime(secondsLeft)}
                    </div>
                    <div className="status-label">{statusLabel}</div>
                  </div>
                </div>
              </div>

              {/* Prompts + Controls */}
              <div className="prompt-panel">
                <div>
                  <div className="prompt-heading">Reflection Prompt</div>
                  <div className="prompt-text">
                    {reflectionPrompts[promptIndex]}
                    <div className="prompt-step">
                      Prompt {promptIndex + 1} of {reflectionPrompts.length}
                    </div>
                  </div>
                </div>

                <div className="controls">
                  <button
                    className="btn-primary"
                    type="button"
                    onClick={handleStartPause}
                  >
                    {isRunning ? "Pause" : "Start Session"}
                  </button>

                  <button
                    className="btn-secondary"
                    type="button"
                    onClick={handleReset}
                  >
                    Reset
                  </button>

                  <button
                    className="btn-ghost"
                    type="button"
                    onClick={toggleMusic}
                  >
                    {isMusicOn ? "Focused Sound Off" : "Focused Sound On"}
                  </button>

                  <span className="sound-indicator">
                    Sound: {isMusicOn ? "On" : "Off"} â€¢ Timer: 5 minutes
                  </span>
                </div>

                <div className="footer-note">
                  <span>
                    Settle in, breathe, and let your thoughts arrive before you
                    capture them.
                  </span>
                  <span>Tip: View in full screen for fewer distractions.</span>
                </div>
              </div>
            </div>
          </div>
        );
      }

      function App() {
        return <ReflectionTimer />;
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
